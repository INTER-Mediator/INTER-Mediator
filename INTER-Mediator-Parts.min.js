var IMParts_Catalog={};IMParts_Catalog.fileupload={html5DDSuported:false,progressSupported:false,forceOldStyleForm:false,uploadId:"sign"+Math.random(),instanciate:function(j){var n,a,e,g;
var f=j.getAttribute("id")+"-e";var p=document.createElement("DIV");INTERMediatorLib.setClassAttributeToNode(p,"_im_fileupload");p.setAttribute("id",f);
this.ids.push(f);if(this.forceOldStyleForm){this.html5DDSuported=false;}else{this.html5DDSuported=true;try{var o=new FileReader();var m=new FormData();
}catch(k){this.html5DDSuported=false;}}g=("ontouchstart" in window);if(g){this.html5DDSuported=false;}if(this.html5DDSuported){p.dropzone="copy";var q=(j.getAttribute("data-im-widget-style")==="false")?false:true;
if(q){p.style.width="200px";p.style.height="100px";p.style.paddingTop="20px";p.style.backgroundColor="#AAAAAA";p.style.border="3px dotted #808080";p.style.textAlign="center";
p.style.fontSize="75%";var d=INTERMediatorOnPage.getMessages()[3101].split(/\n/);for(var h=0;h<d.length;h++){if(h>0){p.appendChild(document.createElement("BR"));
}p.appendChild(document.createTextNode(d[h]));}}}else{a=document.createElement("FORM");a.setAttribute("method","post");a.setAttribute("action",INTERMediatorOnPage.getEntryPath()+"?access=uploadfile");
a.setAttribute("enctype","multipart/form-data");p.appendChild(a);if(this.progressSupported){n=document.createElement("INPUT");n.setAttribute("type","hidden");
n.setAttribute("name","APC_UPLOAD_PROGRESS");n.setAttribute("id","progress_key");n.setAttribute("value",this.uploadId+(this.ids.length-1));a.appendChild(n);
}n=document.createElement("INPUT");n.setAttribute("type","hidden");n.setAttribute("name","_im_redirect");n.setAttribute("value",location.href);a.appendChild(n);
n=document.createElement("INPUT");n.setAttribute("type","hidden");n.setAttribute("name","_im_contextnewrecord");n.setAttribute("value","uploadfile");a.appendChild(n);
n=document.createElement("INPUT");n.setAttribute("type","hidden");n.setAttribute("name","access");n.setAttribute("value","uploadfile");a.appendChild(n);
n=document.createElement("INPUT");n.setAttribute("type","file");n.setAttribute("accept","*/*");n.setAttribute("name","_im_uploadfile");a.appendChild(n);
e=document.createElement("BUTTON");e.setAttribute("type","submit");e.appendChild(document.createTextNode("送信"));a.appendChild(e);this.formFromId[f]=a;}if(j.getAttribute("data-im-move-children")==="true"){var b=j.children;
for(var l=b.length-1;l>=0;l--){p.appendChild(b[l]);}}j.appendChild(p);p._im_getValue=function(){var c=p;return c.value;};j._im_getValue=function(){var c=p;
return c.value;};j._im_getComponentId=function(){var c=f;return c;};j._im_setValue=function(i){var c=p;if(this.html5DDSuported){}else{}};},ids:[],formFromId:{},finish:function(){var d,a;
if(this.html5DDSuported){for(var f=0;f<this.ids.length;f++){var e=this.ids[f];var j=document.getElementById(e);var g=IMLibContextPool.getContextInfoFromId(e);
if(j){INTERMediatorLib.addEvent(j,"dragleave",function(i){i.preventDefault();i.target.style.backgroundColor="#AAAAAA";});INTERMediatorLib.addEvent(j,"dragover",function(i){i.preventDefault();
i.target.style.backgroundColor="#AADDFF";});var k=this.progressSupported;var m=this.ids.length;var c=this.uploadId;INTERMediatorLib.addEvent(j,"drop",(function(){var r=f;
var o=k;var i=m;var q=c;var p=e;return function(w){var v,x;w.preventDefault();var y=w.currentTarget;if(o){var u=document.createElement("iframe");u.setAttribute("id","upload_frame"+i);
u.setAttribute("name","upload_frame");u.setAttribute("frameborder","0");u.setAttribute("border","0");u.setAttribute("scrolling","no");u.setAttribute("scrollbar","no");
u.style.width="100%";u.style.height="24px";y.appendChild(u);}for(var t=0;t<w.dataTransfer.files.length;t++){v=w.dataTransfer.files[t];x=document.createElement("DIV");
x.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3102]+v.name));x.style.marginTop="20px";x.style.backgroundColor="#FFFFFF";x.style.textAlign="center";
w.target.appendChild(x);}var s=IMLibContextPool.getContextInfoFromId(y.getAttribute("id"),"");if(o){u.style.display="block";setTimeout(function(){u.setAttribute("src","upload_frame.php?up_id="+q+r);
});}INTERMediator_DBAdapter.uploadFile("&_im_contextname="+encodeURIComponent(s.context.contextName)+"&_im_field="+encodeURIComponent(s.field)+"&_im_keyfield="+encodeURIComponent(s.record.split("=")[0])+"&_im_keyvalue="+encodeURIComponent(s.record.split("=")[1])+"&_im_contextnewrecord="+encodeURIComponent("uploadfile")+(o?("&APC_UPLOAD_PROGRESS="+encodeURIComponent(q+r)):""),{fileName:v.name,content:v},function(C){var H,E,F=null,z,D,A;
A=IMLibContextPool.getContextDef(s.context.contextName);if(A["file-upload"]){var B="";for(var G in A["file-upload"]){if(A["file-upload"][G]["field"]==s.field){B=A["file-upload"][G]["context"];
break;}}z=IMLibContextPool.getKeyFieldValueFromId(p,"");F=IMLibContextPool.getContextsFromNameAndForeignValue(B,z,A.key);}else{F=IMLibContextPool.getContextFromName(s.context.contextName);
}E=IMLibContextPool.getContextInfoFromId(p,"");E.context.setValue(E.record,E.field,C);if(F){for(D=0;D<F.length;D++){H=F[D];INTERMediator.construct(H);}}INTERMediator.flushMessage();
});};})());}}}else{for(var f=0;f<this.ids.length;f++){var j=document.getElementById(this.ids[f]);if(j){var h=IMLibContextPool.getContextInfoFromId(this.ids[f],"");
var b=j.getElementsByTagName("FORM")[0];var l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_contextname");
l.setAttribute("value",h.context.contextName);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_field");
l.setAttribute("value",h.field);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_keyfield");
l.setAttribute("value",h.record.split("=")[0]);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_keyvalue");
l.setAttribute("value",h.record.split("=")[1]);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","clientid");
if(INTERMediatorOnPage.authUser.length>0){l.value=INTERMediatorOnPage.clientId;}b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");
l.setAttribute("name","authuser");if(INTERMediatorOnPage.authUser.length>0){l.value=INTERMediatorOnPage.authUser;}b.appendChild(l);l=document.createElement("INPUT");
l.setAttribute("type","hidden");l.setAttribute("name","response");if(INTERMediatorOnPage.authUser.length>0){thisForm.elements.cresponse.value=INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+"\n"+INTERMediatorOnPage.authChallenge);
if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){d=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=d.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");
l.value=a;}else{l.value="dummy";}}b.appendChild(l);if(this.progressSupported){l=document.createElement("iframe");l.setAttribute("id","upload_frame"+f);
l.setAttribute("name","upload_frame");l.setAttribute("frameborder","0");l.setAttribute("border","0");l.setAttribute("scrolling","no");l.setAttribute("scrollbar","no");
b.appendChild(l);INTERMediatorLib.addEvent(b,"submit",(function(){var i=f;return function(p){var o=document.getElementById("upload_frame"+i);o.style.display="block";
setTimeout(function(){var q=n()+"?uploadprocess="+this.uploadId+i;o.setAttribute("src",q);});return true;};})());}}}}this.ids=[];this.formFromId={};function n(){var p=document.getElementsByTagName("SCRIPT");
for(var q=0;q<p.length;q++){var o=p[q].getAttribute("src");if(o.match(/\.php/)){return o;}}return null;}}};