# Sample prompt for Windsurf

2024-12-31 Masayuki Nii (nii@msyk.net)

Windsurfを利用して、INTER-Mediatorのアプリケーションを、全く何もないところから（スクラッチから）作成するためのプロンプトです。
別のファイル prompt1.ja.md を利用して作成したプロジェクトに対して、新たな機能を追加する場合を想定しています。
以下の「プロンプト例」以降の文字列を与えますが、その時、プロンプト例以降の内容をそのままコピペして実行してみましょう。
マークアップのままで入力するのが良いようです。もちろん、必要ならプロンプト自体の変更もしてOKです。
現状は、SQLiteのデータベースを作成し、一覧と詳細のページを表示するユーザインタフェースを自動生成します。

# プロンプト例
作成したアプリケーションで、関連情報としてコンタクト記録を付けたいです。

---
# 情報の整理
- ここまでに作られているページファイルを「すでにあるページファイル」と呼びます。
- 
# データベーススキーマの定義
- すでに作られているデータベーススキーマに、新たに関連テーブル定義を追加します。
- 元からあるテーブルの主キー値を記録するフィールドを、新たなテーブルに追加します。
- つまり、外部キーを新しいテーブルに定義して、元からあるテーブルと1対多の関係にするということです。

# 定義ファイルの作成
- 関連情報を表示、入力できるように、ルートに拡張子phpの定義ファイルを作ってください。ファイル名は適当に設定してください。
- PHPのプログラムとして、```vendor/inter-mediator/inter-mediator/INTER-Mediator.php``` をrequired_once関数で読み込みます。
- その後、IM_Entry関数を呼び出します。
  - IM_Entry関数の1つ目の引数は配列です。配列の要素は、連想配列です。
  - 連想配列では、すでにあるテーブルを表示するための要素と、関連テーブル表示用の2つの連想配列を用意してください。
  - いずれの連想配列において、nameキー、viewキーおよび、tableキーは、関連テーブル名と同一です。
  - 関連テーブル表示用の連想配列では、pagingキーに対して値「true」を指定してください。
  - 関連テーブル表示用の連想配列では、recordsキーに対して値「10」を指定してください。
  - すでにあるテーブルを表示するための連想配列では、keyキーに対して元からあるテーブルのキーフィールド名を指定してください。
  - 関連テーブル表示用の連想配列では、keyキーに対して関連テーブルのキーフィールド名を指定してください。
  - 関連テーブル表示用の連想配列では、post-reconstructキーに対し、trueを指定してください。
  - IM_Entry関数の第2、第3引数は、nullにします。第4引数は2にします。

# ページファイルの作成
- ページファイルは、ルートに追加します。ファイル名は、定義ファイルのファイル名で、拡張子は.htmlにします。
- HTMLファイルの基本構成に従って、HTML、HEAD、BODYタグを挿入してください。
- SCRIPTタグで、定義ファイルを読み込むように設定します。
- BODYタグ内に、DIVタグで、id属性が「IM_NAVIGATOR」という要素を用意します。
- BODYタグ内に、tableタグで表を用意します。この表は、「元からあるテーブルのレコード表示テーブル」と呼ぶことにします。
  - 元からあるテーブルのレコード表示テーブルには、元からあるテーブルのすべてのフィールドが1行に入るようにします。
  - 元からあるテーブルのレコード表示テーブルでは、データの編集はできないように、フィールドの内容は、TDタグ内部のSPANタグで表示するようにします。
  - 元からあるテーブルのレコード表示テーブルは、定義ファイルに指定した元からあるテーブル名がnameフィールドとなっているコンテキストを利用して、data-im属性を構築します。
  - 元からあるテーブルのレコード表示テーブルのTDタグのセル内にあるSPANタグには、data-im属性を指定して、ターゲット指定として、定義ファイルに指定した一覧用のコンテキストのnameキーの値、続いて「@」、そしてフィールド名を繋げた文字列を指定します。
  - 関連テーブルの一覧テーブルのTRタグには、属性は必要ありません。
- BODYタグ内に、tableタグで表を用意します。この表は、「関連テーブルの一覧テーブル」と呼ぶことにします。
  - 関連テーブルの一覧テーブルには、関連テーブルのすべてのフィールドが1行に入るようにします。
  - 関連テーブルの一覧テーブルでは、データの編集はできないように、フィールドの内容は、TDタグ内部のSPANタグで表示するようにします。
  - 関連テーブルの一覧テーブルのTDタグのセル内にあるSPANタグには、関連テーブルを利用するコンテキストファイルの連想配列を利用して、data-im属性を指定します。ターゲット指定として、定義ファイルに指定した関連テーブル用のコンテキストのnameキーの値、続いて「@」、そしてフィールド名を繋げた文字列を指定します。
  - 関連テーブルの一覧テーブルのTRタグには、属性は必要ありません。
- BODYタグ内に、さらにtableタグで表を用意します。この表は、「関連テーブルの入力テーブル」と呼ぶことにします。
  - 関連テーブルの入力テーブルのtbodyタグには、data-im-control属性を設定しその値は「post」にします。
  - 関連テーブルの入力テーブルには、関連テーブルのすべてのフィールドに対して、1フィールドを1行に表示します。正、主キーと外部キーのフィールドについては表示しないようにします。
  - 関連テーブルの入力テーブルの1行には、フィールド名をTHタグで、フィールドの内容をTDタグで表示しますが、TDタグ内部はINPUTタグを使って編集可能にします。
  - 関連テーブルの入力テーブルにあるINPUTタグには、data-im属性を指定して、ターゲット指定として、定義ファイルに指定した一覧用のコンテキストのnameキーの値、続いて「@」、そしてフィールド名を繋げた文字列を指定します。
  - 関連テーブルの入力テーブルのTRタグには、属性は必要ありません。
  - 関連テーブルの入力テーブルには、最後にTRタグを挿入し、その中にTHタグとTDタグを挿入します。TDタグには、BUTTONタグで「入力」ボタンを追加します。このボタンのdata-im-control属性には、「post」という文字列を指定します。

# JSファイルの作成
- ルートに、定義ファイルのファイル名をもち、拡張子jsにしたファイルを作成します。このファイルを「スクリプトファイル」と呼びます。
- ページファイルで、SCRIPTタグを用いて、このapp.jsファイルを読み込みます。
- スクリプトファイルでは、INTERMediatorOnPage.doBeforeConstructに無名関数を代入します。この関数を「起動時実行関数」と呼びます。
- 起動時実行関数の中で、INTERMediatorLog.suppressDebugMessageOnPageをtrueにします。
- 起動時実行関数の中で、URLのパラメータを利用します。パラメータは、INTERMediatorOnPage.getURLParametersAsArray()で取り出せます。
- まず、INTERMediator.clearCondition()を呼び出します。引数はなしです。これにより、条件をまとめてクリアします。
- パラメータのidキーの値は、変数に保存しておきます。変数名は、id_valueとします。
- パラメータに「id」キーの値があれば、INTERMediator.addCondition()を呼びます。
- clearConditionの引数には、定義ファイルの元からあるテーブルの連想配列のnameキーに指定した文字列を指定します。
- addConditionの引数には、2つの引数を指定します。最初の引数には、定義ファイルの元からあるテーブルの連想配列のnameキーに指定した文字列を指定します。次の引数は、JavaScriptのオプジェクトとして以下のような内容のものを指定します。
  -「field」キーに対する値として、元からあるテーブルとして定義したときの外部キーフィールドのフィールド名を文字列で指定します。
  -「operator」キーに対する値として、等号を指定します。
  -「value」キーに対する値として、グローバル変数id_valueの値を指定します。
- addConditionの引数には、2つの引数を指定します。最初の引数には、定義ファイルの関連テーブルの連想配列のnameキーに指定した文字列を指定します。次の引数は、JavaScriptのオプジェクトとして以下のような内容のものを指定します。
  -「field」キーに対する値として、関連テーブルとして定義したときの外部キーフィールドのフィールド名を文字列で指定します。
  -「operator」キーに対する値として、等号を指定します。
  -「value」キーに対する値として、グローバル変数id_valueの値を指定します。
- INTERMediator.additionalFieldValueOnNewRecord[コンテキスト名]に配列を代入する。このコードでの「コンテキスト名」は、定義ファイルの関連テーブルの連想配列のnameキーに指定した文字列を指定します。
  - 代入する配列は、要素がオブジェクトで、そのオブジェクトはfieldキーに関連テーブルの外部キーのフィールド名、operationに「=」、valueにグローバル変数id_valueの値を指定するオブジェクトを代入する。

# すでにあるページファイルの修正
- すでにあるページファイルの、一覧のテーブルにある最初のTDタグの中に、ボタンを追加します。
- ボタン名は「コンタクト」などと関連テーブルを連想する名前にします。
- ボタンをクリックすると、新たに作ったページファイルに遷移します。そのための関数を用意して、ボタンのonclick属性にはその関数の呼び出しだけを行います。そして、関数には引数として「$」だけを指定します。
- クリックして呼び出される関数では、location.hrefにURLを代入しますが、そのURLは、「新たに作ったページファイル名」に「?id=引数」を追加します。
- ボタンのdata-im属性には、ターゲット指定を追加します。2つ目のセクションはid、3つ目のセクションは「$onclick」という文字列を指定します。


