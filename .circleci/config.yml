version: 2
jobs:
  build:
    docker:
      - image: docker:17.06.1-ce-git
    working_directory: ~/INTER-Mediator
    steps:
      - checkout
      - setup_remote_docker
      - run: uname -a
      - run: pwd
      - run: ls -al
      - run: ls -al /usr/bin/
      - run:
          command: docker build -t ubuntu ./dist-docs/docker
          no_output_timeout: 1800
      - run: docker image list
      - run: docker run -d --name ubuntu -it ubuntu /bin/bash
      - run: docker ps -a
      - run: docker run -it ubuntu sh -c "/etc/init.d/mysql start && /etc/init.d/postgresql start && phpunit --configuration /var/www/html/INTER-Mediator/INTER-Mediator-UnitTest/phpunit.xml /var/www/html/INTER-Mediator/INTER-Mediator-UnitTest/INTERMediator_AllTests.php"
      - run: docker run -it ubuntu php -v
      - run: docker run -it ubuntu sh -c "/etc/rc.local && /usr/local/bin/buster-test -r specification -c /var/www/html/INTER-Mediator/spec/buster.js"
      - run: docker run -it ubuntu ls -al /usr/bin/
      - run: docker run -it ubuntu ls -al /usr/local/bin/
      - run: docker run -e BUNDLE_GEMFILE=/var/www/html/INTER-Mediator/dist-docs/docker/Gemfile -it ubuntu bundle
      #- run: gem install rspec --no-doc
      #- run: rspec --default-path=/var/www/html/INTER-Mediator/dist-docs/docker/spec /var/www/html/INTER-Mediator/dist-docs/docker/spec/container/container_spec.rb -f doc -c
      #- run: rspec --default-path=/var/www/html/INTER-Mediator/dist-docs/docker/spec /var/www/html/INTER-Mediator/dist-docs/docker/spec/trainingcourse/trainingcourse_spec.rb -f doc -c
      - run: docker stop ubuntu
      - run: docker rm ubuntu
